#include "CC1110.h"
#include "global.h"
#include <string.h>
#include <stdio.h>

#pragma import(__use_no_semihosting)             
//标准库需要的支持函数                 
struct __FILE 
{ 
	int handle; 

}; 
FILE __stdout;       
//定义_sys_exit()以避免使用半主机模式    
void _sys_exit( int x) 
{ 
	x = x; 
} 
//重定义fputc函数 
int fputc(int ch, FILE *f)
{      
	while((USART1->SR&0X40)==0) //循环发送,直到发送完毕   
    USART1->DR = (uint8_t) ch;      
	return ch;
}
/**************************************************************
函数：void CC1110_Config (uint32_t baud_rate)
功能：CC1110用的是UART1通讯 PA9-UART_TX;PA10-UART_RX;PA5-ACT;PA8-BUF
**************************************************************/
void CC1110_Config (uint32_t baud_rate)
{
  GPIO_InitTypeDef GPIO_InitStructure;
	USART_InitTypeDef USART_InitStructure;
	RCC->APB1ENR |= RCC_APB1Periph_USART3;
	RCC->AHBENR |= RCC_AHBPeriph_GPIOB;
	
	GPIO_PinAFConfig(GPIOB, GPIO_PinSource10,GPIO_AF_USART3);
  GPIO_PinAFConfig(GPIOB,GPIO_PinSource11,GPIO_AF_USART3);
/*********************?????T??悫??PA9--TX*************************/
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_40MHz;
  GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
  GPIO_Init(GPIOB, &GPIO_InitStructure);
/*********************?????T??悫??PA10--RX*************************/
  GPIO_InitStructure.GPIO_Pin =GPIO_Pin_11;
  GPIO_Init(GPIOB,&GPIO_InitStructure);
/*********************配置无线通讯TX RX*************************/
  USART_InitStructure.USART_BaudRate = baud_rate;
  USART_InitStructure.USART_WordLength = USART_WordLength_8b;
  USART_InitStructure.USART_StopBits = USART_StopBits_1;
  USART_InitStructure.USART_Parity = USART_Parity_No;
  USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
  USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
  USART_Init(USART3,&USART_InitStructure);
  USART_Cmd(USART3, ENABLE);
}

/**************************************************************
函数：void CC1110_Send (uint8_t * TxMsg ,int len)
功能：CC1110发送函数
**************************************************************/
void CC1110_Send (uint8_t * TxMsg ,int len)
{
	int i;
	USART3->SR = (uint16_t)~0x0040;
	for(i=0;i<len;i++)
	{
		USART3->DR = (*(TxMsg+i) & (uint16_t)0x01FF);
		while((USART3->SR & 0x0080) == RESET); //发送完成标志
	}
}


